<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Strivus - AI Fitness Coach</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0e27">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/glassomorphism.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Tab Navigation (Desktop) -->
        <nav class="tab-nav" id="tabNav">
            <button class="tab-button active" data-tab="dashboard">
                <span>üéØ</span> Dashboard
            </button>
            <button class="tab-button" data-tab="record">
                <span>üìù</span> Record
            </button>
            <button class="tab-button" data-tab="history">
                <span>üìä</span> History
            </button>
            <button class="tab-button" data-tab="condition">
                <span>üí™</span> Condition
            </button>
            <button class="tab-button" data-tab="ai-coach">
                <span>ü¶Ñ</span> AI Coach
            </button>
            <button class="tab-button" data-tab="settings" style="margin-left: auto;">
                <span>‚öôÔ∏è</span> Settings
            </button>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Tab - Training Selection Wizard -->
            <div class="tab-content active" id="dashboard-tab">
                <div class="tab-scroll-area">
                    <!-- Welcome Header -->
                    <div class="glass-card" style="margin-bottom: 24px; text-align: center;">
                        <h1 id="dashboardGreeting">Today's Training</h1>
                        <p class="text-secondary" id="dashboardSubtitle">Let's build something amazing</p>
                    </div>

                    <!-- Readiness Status -->
                    <div class="readiness-gauge" style="margin-bottom: 24px;">
                        <div class="gauge-value">
                            <span id="dashReadiness">--</span>
                        </div>
                    </div>
                    <p class="text-tertiary" style="text-align: center; margin-bottom: 24px;" id="dashReadinessStatus">Log your check-in to see readiness</p>

                    <!-- Training Selection Wizard -->
                    <div class="glass-card" style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px;">1. Focus Area</h3>
                        <div class="quick-buttons">
                            <button class="quick-btn" data-training-type="strength">üí™ Strength</button>
                            <button class="quick-btn" data-training-type="hypertrophy">üî• Hypertrophy</button>
                            <button class="quick-btn" data-training-type="endurance">‚ö° Endurance</button>
                            <button class="quick-btn" data-training-type="sport">üèÉ Sport</button>
                        </div>
                    </div>

                    <!-- Intensity Sliders -->
                    <div class="glass-card" style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px;">2. Target Intensity</h3>

                        <label class="text-secondary" style="display: block; margin-bottom: 12px;">
                            Upper Body Focus: <span id="upperValue">50</span>%
                        </label>
                        <input type="range" min="0" max="100" value="50" id="upperSlider" class="glass-slider" style="margin-bottom: 16px;">

                        <label class="text-secondary" style="display: block; margin-bottom: 12px;">
                            Lower Body Focus: <span id="lowerValue">50</span>%
                        </label>
                        <input type="range" min="0" max="100" value="50" id="lowerSlider" class="glass-slider" style="margin-bottom: 16px;">

                        <label class="text-secondary" style="display: block; margin-bottom: 12px;">
                            Core Focus: <span id="coreValue">30</span>%
                        </label>
                        <input type="range" min="0" max="100" value="30" id="coreSlider" class="glass-slider">
                    </div>

                    <!-- Equipment Selection -->
                    <div class="glass-card" style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px;">3. Equipment Available</h3>
                        <div class="quick-buttons">
                            <button class="quick-btn" data-equipment="barbell">üèãÔ∏è Barbell</button>
                            <button class="quick-btn" data-equipment="dumbbell">üî® Dumbbell</button>
                            <button class="quick-btn" data-equipment="machine">‚öôÔ∏è Machine</button>
                            <button class="quick-btn" data-equipment="bodyweight">üßò Bodyweight</button>
                        </div>
                    </div>

                    <!-- Persona Selection -->
                    <div class="glass-card" style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 16px;">4. Coaching Style</h3>
                        <div class="quick-buttons">
                            <button class="quick-btn" data-persona="aggressive">üî• Aggressive</button>
                            <button class="quick-btn" data-persona="balanced">‚öñÔ∏è Balanced</button>
                            <button class="quick-btn" data-persona="supportive">ü§ó Supportive</button>
                        </div>
                    </div>

                    <!-- Advanced Options -->
                    <details>
                        <summary class="glass-btn glass-btn-secondary" style="width: 100%; text-align: left; cursor: pointer;">
                            ‚öôÔ∏è Advanced Options
                        </summary>
                        <div class="glass-card" style="margin-top: 12px;">
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">
                                <input type="checkbox" id="focusRecovery"> Focus on Recovery
                            </label>
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">
                                <input type="checkbox" id="focusBalance"> Balance Lagging Muscle Groups
                            </label>
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">
                                <input type="checkbox" id="includeWarmup"> Include Warm-up
                            </label>
                        </div>
                    </details>

                    <!-- Quick Actions -->
                    <div style="margin-top: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button class="glass-btn glass-btn-primary" onclick="switchTab('record')" style="width: 100%;">
                            üìù Start Training
                        </button>
                        <button class="glass-btn glass-btn-secondary" onclick="switchTab('history')" style="width: 100%;">
                            üìä View Stats
                        </button>
                    </div>
                </div>
            </div>

            <!-- Record Tab -->
            <div class="tab-content" id="record-tab">
                <div class="tab-scroll-area">
                    <!-- Progress Bar -->
                    <div class="progress-bar">
                        <div class="progress-fill" id="recordProgress" style="width: 20%;"></div>
                    </div>

                    <!-- Steps Indicator -->
                    <div class="steps-container">
                        <div class="step-indicator active" id="step1">1</div>
                        <div class="step-divider"></div>
                        <div class="step-indicator" id="step2">2</div>
                        <div class="step-divider"></div>
                        <div class="step-indicator" id="step3">3</div>
                        <div class="step-divider"></div>
                        <div class="step-indicator" id="step4">4</div>
                        <div class="step-divider"></div>
                        <div class="step-indicator" id="step5">5</div>
                    </div>

                    <!-- Step Content -->
                    <div id="recordContent">
                        <!-- Step 1: Date & Activity Type -->
                        <div class="record-step active" id="recordStep1">
                            <h3>Select Date & Activity</h3>
                            <div style="margin-top: 16px;">
                                <label class="text-secondary" style="display: block; margin-bottom: 8px;">Date</label>
                                <input type="date" id="workoutDate" class="glass-input" value="">
                            </div>
                            <div style="margin-top: 16px;">
                                <label class="text-secondary" style="display: block; margin-bottom: 8px;">Activity Type</label>
                                <select id="activityType" class="glass-select">
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="sport">Sport</option>
                                    <option value="mixed">Mixed</option>
                                </select>
                            </div>
                        </div>

                        <!-- Step 2: Exercise Selection -->
                        <div class="record-step" id="recordStep2" style="display: none;">
                            <h3>Add Exercises</h3>
                            <p class="text-tertiary" style="margin-top: 8px;">Tap to add exercises</p>
                            <div id="selectedExercises" style="margin-top: 16px;"></div>
                            <button class="glass-btn glass-btn-primary" onclick="openExercisePicker()" style="width: 100%; margin-top: 16px;">
                                + Add Exercise
                            </button>
                        </div>

                        <!-- Step 3: Log Sets -->
                        <div class="record-step" id="recordStep3" style="display: none;">
                            <h3>Log Sets</h3>
                            <div id="setsContainer" style="margin-top: 16px;"></div>
                        </div>

                        <!-- Step 4: RPE, Duration & Notes -->
                        <div class="record-step" id="recordStep4" style="display: none;">
                            <h3>Intensity, Duration & Notes</h3>
                            <div style="margin-top: 16px;">
                                <label class="text-secondary" style="display: block; margin-bottom: 8px;">RPE (Rate of Perceived Exertion)</label>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <input type="range" min="1" max="10" value="5" id="rpeSlider" class="glass-slider" style="flex: 1;">
                                    <span id="rpeValue" style="min-width: 40px; text-align: center; font-weight: 600;">5</span>
                                </div>
                            </div>
                            <div style="margin-top: 16px;">
                                <label class="text-secondary" style="display: block; margin-bottom: 8px;">Total Duration (minutes)</label>
                                <input type="number" id="durationInput" class="glass-input" placeholder="45" value="45" min="1" max="600">
                            </div>
                            <div style="margin-top: 16px;">
                                <label class="text-secondary" style="display: block; margin-bottom: 8px;">Notes</label>
                                <textarea id="workoutNotes" class="glass-textarea" placeholder="Add any notes..." style="resize: none; height: 80px;"></textarea>
                            </div>
                        </div>

                        <!-- Step 5: Review -->
                        <div class="record-step" id="recordStep5" style="display: none;">
                            <h3>Review Workout</h3>
                            <div class="glass-card" style="margin-top: 16px;">
                                <p><strong>Date:</strong> <span id="reviewDate"></span></p>
                                <p><strong>Exercises:</strong> <span id="reviewExercises"></span></p>
                                <p><strong>Intensity:</strong> <span id="reviewRPE"></span>/10</p>
                            </div>
                            <p class="text-tertiary" style="margin-top: 16px; text-align: center;">Ready to save? Tap Save to finish.</p>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div style="display: flex; gap: 12px; margin-top: 24px;">
                        <button class="glass-btn glass-btn-secondary" onclick="recordPrevStep()" id="recordPrevBtn" style="flex: 1; display: none;">Back</button>
                        <button class="glass-btn glass-btn-primary" onclick="recordNextStep()" id="recordNextBtn" style="flex: 1;">Next</button>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history-tab">
                <!-- Sub-tabs -->
                <div class="tab-nav" style="background: transparent; border: none; padding: 12px;">
                    <button class="tab-button active" data-subtab="recent" onclick="switchHistorySubtab('recent')">Recent</button>
                    <button class="tab-button" data-subtab="prs" onclick="switchHistorySubtab('prs')">PRs</button>
                    <button class="tab-button" data-subtab="analytics" onclick="switchHistorySubtab('analytics')">Analytics</button>
                    <button class="tab-button" data-subtab="trends" onclick="switchHistorySubtab('trends')">Trends</button>
                </div>

                <div class="tab-scroll-area">
                    <!-- Recent Workouts -->
                    <div class="history-subtab active" id="historyRecent">
                        <h3 style="margin-bottom: 16px;">Recent Workouts</h3>
                        <div id="recentWorkoutsList"></div>
                    </div>

                    <!-- Personal Records -->
                    <div class="history-subtab" id="historyPRs" style="display: none;">
                        <h3 style="margin-bottom: 16px;">Personal Records</h3>
                        <div class="glass-grid cols-2" id="prsList"></div>
                    </div>

                    <!-- Analytics -->
                    <div class="history-subtab" id="historyAnalytics" style="display: none;">
                        <h3 style="margin-bottom: 16px;">Analytics</h3>
                        <div class="glass-grid cols-2" id="analyticsList"></div>
                    </div>

                    <!-- Trends -->
                    <div class="history-subtab" id="historyTrends" style="display: none;">
                        <h3 style="margin-bottom: 16px;">Monthly Trends</h3>
                        <canvas id="trendChart" style="max-width: 100%; margin: 16px 0;"></canvas>
                        <div id="trendSummary" class="glass-card" style="margin-top: 16px;"></div>
                    </div>
                </div>
            </div>

            <!-- Condition Tab -->
            <div class="tab-content" id="condition-tab">
                <!-- Sub-tabs -->
                <div class="tab-nav" style="background: transparent; border: none; padding: 12px;">
                    <button class="tab-button active" data-subtab="today" onclick="switchConditionSubtab('today')">Today</button>
                    <button class="tab-button" data-subtab="history" onclick="switchConditionSubtab('history')">History</button>
                    <button class="tab-button" data-subtab="trends" onclick="switchConditionSubtab('trends')">Trends</button>
                </div>

                <div class="tab-scroll-area">
                    <!-- Today's Check-in -->
                    <div class="condition-subtab active" id="conditionToday">
                        <h2 style="text-align: center; margin-bottom: 24px;">Morning Readiness Check-In</h2>

                        <!-- Readiness Gauge -->
                        <div class="readiness-gauge">
                            <div class="gauge-value">
                                <span id="readinessScore">--</span>
                            </div>
                        </div>

                        <!-- Readiness Level Text -->
                        <p class="text-tertiary" style="text-align: center; margin-bottom: 24px;" id="readinessText">Log your check-in to see readiness</p>

                        <!-- Check-in Inputs -->
                        <div style="margin-bottom: 24px;">
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">Sleep Quality</label>
                            <div class="quick-buttons">
                                <button class="quick-btn" data-metric="sleep" data-value="1">üò¥</button>
                                <button class="quick-btn" data-metric="sleep" data-value="2">üòê</button>
                                <button class="quick-btn" data-metric="sleep" data-value="3">üòä</button>
                                <button class="quick-btn" data-metric="sleep" data-value="4">üòÑ</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">Energy Level</label>
                            <div class="quick-buttons">
                                <button class="quick-btn" data-metric="energy" data-value="1">‚ö°</button>
                                <button class="quick-btn" data-metric="energy" data-value="2">üîã</button>
                                <button class="quick-btn" data-metric="energy" data-value="3">üí™</button>
                                <button class="quick-btn" data-metric="energy" data-value="4">üöÄ</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">Soreness/Fatigue</label>
                            <div class="quick-buttons">
                                <button class="quick-btn" data-metric="soreness" data-value="1">üòñ</button>
                                <button class="quick-btn" data-metric="soreness" data-value="2">üòï</button>
                                <button class="quick-btn" data-metric="soreness" data-value="3">üòê</button>
                                <button class="quick-btn" data-metric="soreness" data-value="4">üòä</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <label class="text-secondary" style="display: block; margin-bottom: 12px;">Mood</label>
                            <div class="quick-buttons">
                                <button class="quick-btn" data-metric="mood" data-value="1">üòû</button>
                                <button class="quick-btn" data-metric="mood" data-value="2">üòê</button>
                                <button class="quick-btn" data-metric="mood" data-value="3">üòä</button>
                                <button class="quick-btn" data-metric="mood" data-value="4">üòÑ</button>
                            </div>
                        </div>

                        <button class="glass-btn glass-btn-primary" onclick="saveCheckIn()" style="width: 100%;">Save Check-In</button>

                        <!-- AI Insights -->
                        <div class="glass-card" style="margin-top: 24px;">
                            <h3>AI Readiness Forecast</h3>
                            <p class="text-secondary" id="readinessForecast" style="margin-top: 12px;">Log your check-in to see forecast</p>
                        </div>
                    </div>

                    <!-- History -->
                    <div class="condition-subtab" id="conditionHistory" style="display: none;">
                        <h3 style="margin-bottom: 16px;">Past 7 Days</h3>
                        <div id="checkInHistory"></div>
                    </div>

                    <!-- Trends -->
                    <div class="condition-subtab" id="conditionTrends" style="display: none;">
                        <h3 style="margin-bottom: 16px;">Readiness Trends</h3>
                        <canvas id="readinessTrendChart" style="max-width: 100%; margin-bottom: 24px;"></canvas>
                        <div id="readinessSummary" class="glass-card"></div>
                    </div>
                </div>
            </div>

            <!-- AI Coach Tab -->
            <div class="tab-content" id="ai-coach-tab">
                <!-- AI Character -->
                <div style="background: rgba(0, 217, 255, 0.05); padding: 20px; text-align: center; border-bottom: 1px solid var(--border-light);">
                    <div style="font-size: 100px; margin-bottom: 12px;">ü¶Ñ</div>
                    <h3>Your AI Fitness Coach</h3>
                    <p class="text-secondary">Ask me anything about your training</p>
                </div>

                <div class="tab-scroll-area" id="chatArea" style="display: flex; flex-direction: column;">
                    <!-- Chat Messages -->
                    <div id="chatMessages" style="flex: 1; margin-bottom: 16px;"></div>
                </div>

                <!-- Chat Input Area -->
                <div style="padding: 16px; background: rgba(0, 0, 0, 0.2); border-top: 1px solid var(--border-light);">
                    <!-- Quick Prompts -->
                    <div style="margin-bottom: 12px; display: flex; gap: 8px; overflow-x: auto;">
                        <button class="glass-btn glass-btn-small" onclick="sendAIPrompt('What should I focus on today?')">Today's Focus</button>
                        <button class="glass-btn glass-btn-small" onclick="sendAIPrompt('Give me a form tip')">Form Tips</button>
                        <button class="glass-btn glass-btn-small" onclick="sendAIPrompt('Recovery advice?')">Recovery</button>
                    </div>

                    <!-- Input -->
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="aiInput" class="glass-input" placeholder="Ask your AI coach..." style="flex: 1;">
                        <button class="glass-btn glass-btn-primary" onclick="sendAIMessage()">Send</button>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings-tab">
                <div class="tab-scroll-area">
                    <h2>Settings</h2>

                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>Account</h3>
                        <div style="margin-top: 16px;">
                            <p class="text-secondary" id="settingsEmail">Email: Loading...</p>
                        </div>
                    </div>

                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>Data</h3>
                        <button class="glass-btn glass-btn-secondary" onclick="exportData()" style="width: 100%; margin-top: 12px;">
                            Export Data
                        </button>
                        <button class="glass-btn glass-btn-secondary" onclick="clearAllData()" style="width: 100%; margin-top: 12px; color: var(--error);">
                            Clear All Data
                        </button>
                    </div>

                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>App</h3>
                        <button class="glass-btn glass-btn-secondary" onclick="logout()" style="width: 100%; margin-top: 12px;">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav" id="bottomNav">
            <button class="bottom-nav-item active" data-tab="dashboard" onclick="switchTab('dashboard')">
                <span class="nav-icon">üéØ</span>
                <span>Home</span>
            </button>
            <button class="bottom-nav-item" data-tab="record" onclick="switchTab('record')">
                <span class="nav-icon">üìù</span>
                <span>Record</span>
            </button>
            <button class="bottom-nav-item" data-tab="history" onclick="switchTab('history')">
                <span class="nav-icon">üìä</span>
                <span>History</span>
            </button>
            <button class="bottom-nav-item" data-tab="condition" onclick="switchTab('condition')">
                <span class="nav-icon">üí™</span>
                <span>Check-in</span>
            </button>
            <button class="bottom-nav-item" data-tab="ai-coach" onclick="switchTab('ai-coach')">
                <span class="nav-icon">ü¶Ñ</span>
                <span>Coach</span>
            </button>
        </nav>
    </div>

    <!-- Scripts -->
    <script src="/js/auth-guard.js"></script>
    <script src="/js/ai-character.js"></script>
    <script src="/js/supabase-client.js"></script>
    <script src="/js/exercise-service.js"></script>
    <script src="/js/workout-service.js"></script>
    <script src="/js/index-page.js"></script>
    <script src="/js/tab-system.js"></script>
    <script src="/js/swipe-navigation.js"></script>
</body>
</html>
